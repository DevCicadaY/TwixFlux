from src.modules.browser.browser_launcher import load_config  # –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
from src.utils.logger import logger  # –ò–º–ø–æ—Ä—Ç –ª–æ–≥–≥–µ—Ä–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤

from src.modules.secure_token_manage.token_storage_manager import AUTH_TOKEN  # –ò–º–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π AUTH_TOKEN –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ cookie

AUTH_TOKEN  # –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cookies
def set_auth_cookie(driver, AUTH_TOKEN):
    try:
        logger.info("üåê –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–∞–π—Ç Twitch...")  # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–∞–π—Ç Twitch
        driver.get("https://www.twitch.tv")  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–∞–π—Ç Twitch
        logger.info("‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ auth-token –≤ cookies...")  # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Ç–æ–∫–µ–Ω–∞ –≤ cookies
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ cookie
        logger.debug(f"üç™ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie: auth-token={AUTH_TOKEN}, domain=.twitch.tv, path=/")  # –õ–æ–≥–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã cookie
        
        driver.add_cookie({
            "name": "auth-token",  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è cookie
            "value": AUTH_TOKEN,  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ cookie –∫–∞–∫ auth-token
            "domain": ".twitch.tv",  # –£–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–º–µ–Ω –¥–ª—è cookie
            "path": "/",  # –£–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –¥–ª—è cookie
        })
        
        # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É cookie
        logger.info("üç™ auth-token —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ cookies.")  # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ cookies
        
        driver.refresh()  # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        logger.info("üîÑ –°–∞–π—Ç Twitch –æ–±–Ω–æ–≤–ª–µ–Ω, auth-token –ø—Ä–∏–º–µ–Ω–µ–Ω.")  # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        
        # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        current_url = driver.current_url  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        logger.info(f"üåç –¢–µ–∫—É—â–∏–π URL –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {current_url}")  # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL

    except Exception as e:  # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ cookie –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}", exc_info=True)  # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É

        # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
        if hasattr(driver, 'current_url'):  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞—Ç—Ä–∏–±—É—Ç current_url —É –¥—Ä–∞–π–≤–µ—Ä–∞
            current_url = driver.current_url  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π URL
            logger.info(f"üåç –¢–µ–∫—É—â–∏–π URL –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—à–∏–±–∫–∏: {current_url}")  # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—à–∏–±–∫–∏

        driver.quit()  # –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
        logger.info("üö® –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏.")  # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
        
        exit()  # –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞