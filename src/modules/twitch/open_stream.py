from selenium.webdriver.common.by import By  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞ –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
from selenium.webdriver.support.ui import WebDriverWait  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
from selenium.webdriver.support import expected_conditions as EC  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è —É—Å–ª–æ–≤–∏–π –æ–∂–∏–¥–∞–Ω–∏—è
from src.modules.browser.browser_launcher import load_config  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
from src.utils.logger import logger  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤

# –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∏–º–∞
def open_stream(driver, stream_url):  # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∏–º–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É URL
    try:
        logger.info(f"üåê –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∏–º: {stream_url}")  # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∏–º
        driver.get(stream_url)  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ç—Ä–∏–º–∞ –ø–æ URL
        logger.info(f"‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {stream_url}...")  # –õ–æ–≥–∏—Ä—É–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ

        # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ video
        WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.TAG_NAME, "video")))  # –û–∂–∏–¥–∞–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ video –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        logger.info(f"‚úÖ –í–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å—Ç—Ä–∏–º–µ: {stream_url}")  # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        logger.info("üé• –°—Ç—Ä–∏–º —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç.")  # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∏–º–∞
        
        # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∏–º–∞
        current_url = driver.current_url  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        logger.info(f"üåç –¢–µ–∫—É—â–∏–π URL –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∏–º–∞: {current_url}")  # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL

    except Exception as e:  # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∏–º–∞: {e}", exc_info=True)  # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –∏ —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤

        # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
        if hasattr(driver, 'current_url'):  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞—Ç—Ä–∏–±—É—Ç current_url —É –¥—Ä–∞–π–≤–µ—Ä–∞
            current_url = driver.current_url  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π URL
            logger.info(f"üåç –¢–µ–∫—É—â–∏–π URL –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—à–∏–±–∫–∏: {current_url}")  # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π URL –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—à–∏–±–∫–∏

        driver.quit()  # –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
        logger.info("üö® –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏.")  # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏
        
        exit()  # –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞