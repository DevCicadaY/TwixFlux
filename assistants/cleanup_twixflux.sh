#!/bin/bash

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .TwixFlux
remove_twixflux_directory() {
  local USER_HOME="$HOME"  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  local TWIXFLUX_DIR="$USER_HOME/.TwixFlux"  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .TwixFlux

  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è .TwixFlux
  if [ -d "$TWIXFLUX_DIR" ]; then
    # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–¥–∞–ª—è–µ–º –µ—ë
    rm -rf "$TWIXFLUX_DIR"
    echo "‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è .TwixFlux —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞."
  else
    # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    echo "üö® –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è .TwixFlux –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –∏–∑ –∫–ª—é—á–Ω–∏—Ü—ã
remove_files_and_folders() { 
    local service_name="TwixFlux"  # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–¥–∞—ë–º –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä–æ–ª—è –≤ –∫–ª—é—á–Ω–∏—Ü–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
    if security find-generic-password -s "$service_name" &>/dev/null; then
        echo "üîë ‚úÖ –ü–∞—Ä–æ–ª—å –¥–ª—è $service_name –Ω–∞–π–¥–µ–Ω, —É–¥–∞–ª—è—é..."
        security delete-generic-password -s "$service_name" &>/dev/null
        echo "‚úÖ –ü–∞—Ä–æ–ª—å –¥–ª—è $service_name —É–¥–∞–ª—ë–Ω."
    else
        echo "üö® –ü–∞—Ä–æ–ª—å –¥–ª—è $service_name –Ω–µ –Ω–∞–π–¥–µ–Ω."
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º _MEI
cleanup_meim_files() {
    # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ
    local dir="/private/var/folders/1j/8q51xcjs5g7g1nx9wd8tws3r0000gn/T"
    
    # –ò—â–µ–º —Ñ–∞–π–ª—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "_MEI"
    local files=$(ls "$dir" | grep "_MEI")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∏–µ —Ñ–∞–π–ª—ã
    if [ -n "$files" ]; then
        echo "üóëÔ∏è –§–∞–π–ª—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º _MEI –Ω–∞–π–¥–µ–Ω—ã:"
        echo "$files"
        
        # –£–¥–∞–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        for file in $files; do
            rm -rf "$dir/$file"
            echo "‚úÖ –£–¥–∞–ª—ë–Ω —Ñ–∞–π–ª: $file"
        done
    else
        echo "üö® –§–∞–π–ª—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º _MEI –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."
    fi
}

# –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
remove_twixflux_directory  # –£–¥–∞–ª—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .TwixFlux
cleanup_meim_files         # –û—á–∏—â–∞–µ—Ç —Ñ–∞–π–ª—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º _MEI
remove_files_and_folders   # –£–¥–∞–ª—è–µ—Ç –ø–∞—Ä–æ–ª–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã